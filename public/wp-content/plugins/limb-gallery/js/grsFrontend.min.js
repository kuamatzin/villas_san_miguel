function insertCss(e,t){var a=document.head,n=document.createElement("link"),i="Album"!=e.view?"gallery":"album",o="Album"==e.view?e.mainview:e.view,r="Album"==e.view?e.galview:"";n.type="text/css",n.rel="stylesheet",n.href=grsAjaxUrl+"?action=grsGalleryAjax&grsAction=grsFrontendCss&id="+e.theme+"&grs="+t+"&type="+i+"&view="+o+"&galview="+r+"&exist=0",a.appendChild(n),n.grs=t,a.appendChild(n),n.onload=function(){var e=document.querySelector("#grsGal"+this.grs+" > div"),t=angular.element(e).scope();t.params.cssReady=!0,t.$$phase||t.$apply()}}var html=document.getElementsByTagName("html")[0],grsApp=angular.module("grsApp",["ngTouch"]);angular.element(document).ready(function(){var e=document.createElement("div"),t=document.createElement("grs-popup");e.setAttribute("ng-controller","grsPopupC"),e.setAttribute("class","grsPopup"),t.setAttribute("resize","resize"),e.appendChild(t),document.body.appendChild(e),angular.bootstrap(html,["grsApp"])}),grsApp.directive("imageOnload",["GrsService",function(e){return{restrict:"A",link:function(e,t,a){t.bind("load",function(){e.$apply(a.imageOnload)})}}}]),grsApp.directive("backImg",["GrsService",function(e){return{restrict:"A",scope:!0,link:function(e,t,a){var n=a.backImg;n=n.replace(/'/g,"\\'"),t.css({"background-image":"url('"+n+"')"})}}}]),grsApp.directive("ifrSrc",["GrsService",function(e){return{restrict:"A",scope:!0,link:function(e,t,a){var n=a.ifrSrc;n=n.replace(/'/g,"\\'"),t.attr("src",n)}}}]),grsApp.directive("vgSrc",["GrsService",function(e){return{restrict:"A",scope:!0,link:function(e,t,a){var n=a.vgSrc;n=n.replace(/'/g,"\\'"),t.attr("src",n)}}}]),grsApp.service("GrsService",["$log",function(e){this.mode="pro",this.uploaderUrl=grsUploaderUrl,this.shareUrl=grsShareUrl,this.pluginUrl=grsPluginUrl,this.pluginVer=grsPluginVer,this.config=grsConfig,this.imagesDir=this.pluginUrl+"/images/",this.effectsJsonUrl=this.pluginUrl+"/frontend/views/grsEffects.json?ver="+this.pluginVer,this.getViewsTemplateUrl=function(e){return this.pluginUrl+"/frontend/views/"+e+".html?ver="+this.pluginVer},this.popup={grs:0,show:!1,shatts:{},theme:{},first:!0,items:[],pI:[],cP:0,pC:0,tC:0,lC:0,index:0},this.setPopObj=function(e){if(this.popup.grs=e.grs,this.popup.gallId=e.gallId,this.popup.shatts=e.shatts,this.popup.theme=e.theme,this.popup.items=e.items,this.popup.cP=e.cP,this.popup.pC=e.pC,this.popup.tC=e.tC,this.popup.lC=e.lC,this.popup.index=e.index,0!=e.pC)for(var t=0;t<e.pC;t++)"undefined"!=typeof e.pI[t]&&(this.popup.pI[t]=e.pI[t]);else this.popup.pI=[];this.log(e),this.popup.show=angular.copy(e.show)},this.grsShTC=function(e,t){return"always"==e||"onhover"==e&&"mask"!=t},this.grsShMC=function(e,t){return"mask"==t&&"onhover"==e},this.grsOnhv=function(e){return"onhover"==e},this.settings={},this.log=function(t){"dev"==this.mode&&e.log(t)},this.getImageVer=function(e,t){var a=parseInt(e.thumbWidth),n=parseInt(e.thumbHeight),i="thumbnail"==t?2:1;return a<=400/i&&n<=400/i?"thumbnail/":a<=800/i&&n<=800/i?"medium/":a<=1500/i&&n<=1500/i?"large/":a<=2e3/i&&n<=2e3/i?"extralarge/":"thumbnail/"},this.getFilmImageVer=function(e,t){return e<=200?"thumbnail/":e<=400?"medium/":e<=750?"large/":e<=1e3?"extralarge/":"thumbnail/"},this.getLightboxImageVer=function(e,t){var a="";return e<=400&&t<=400?a="thumbnail/":e<=800&&t<=800?a="medium/":e<=1500&&t<=1500?a="large/":e<=2e3&&t<=2e3&&(a="extralarge/"),a},this.getImageSource=function(e,t){return this["itemSource_"+e.embed](e,t)},this.itemSource_=function(e,t){var a=this.getImageVer(e,t);return this.uploaderUrl+e.path+a+e.name+e.type},this.itemSource_instagram=function(e){return e.thumb_url},this.itemSource_youtube=function(e){return e.thumb_url},this.itemSource_vimeo=function(e){return e.thumb_url},this.itemSource_flickr=function(e){return e.thumb_url},this.shVIc=function(e){var t=e.type;return"video"==t||"link"==t}}]),grsApp.controller("grsPopupC",["$scope","$filter","$log","GrsService",function(e,t,a,n){}]),grsApp.directive("grsPopup",["$filter","GrsFactory","GrsService","$window","$timeout",function(e,t,a,n,i){return{restrict:"E",transclude:!0,scope:!1,templateUrl:a.getViewsTemplateUrl("grsPopup"),link:function(e,o,r){if(e.options={show:a.popup.show},e.options.enterPopup=function(){return e.options.show&&e.options.effectsLoaded},e.options.showPopup=function(){return e.view.ready=e.options.commContloaded&&e.options.filmContLoaded,e.view.ready},e.params={grs:0,gallId:a.popup.gallId,shatts:a.popup.shatts,theme:a.popup.theme},e.psImg={},t.getSettings().then(function(e){"undefined"!=typeof e.data.success?(a.settings=e.data.success,a.log(a.settings)):a.log("Error , try to get settings.")},function(e){a.log(e)}),a.config.effects)t.getEffects().then(function(t){e.grsEffects=t.data,e.options.show&&e.setEffect(e.params.shatts.lightboxeffect),e.options.effectsLoaded=!0,e.$$phase||e.$apply()},function(e){a.log(e)});else{var s={};s.noEffect={},s.noEffect.effects={},s.noEffect.effects.no={},s.noEffect.doEffect="grsNoEffect",s.noCutting={},s.noCutting.effects={},s.noCutting.effects.fade={},s.noCutting.effects.fade["in"]="grsFadeIn grsAnDur inAnimationEnd",s.noCutting.effects.fade.out="grsFadeOut grsAnDur outAnimationEnd",s.noCutting.doEffect="grsNoCuting",e.grsEffects=s,e.options.effectsLoaded=!0}e.view={cImIn:0,effect:{},mainAnimationEnd:!0,cImInG:-1,grsCC:[],isFS:!1,isFSSmart:!1,active:"",actImg:"",captcha:"",comments:{},isOCC:!0,contButtOp:!1,filmView:a.getViewsTemplateUrl("grsFilmstrip"),commView:a.getViewsTemplateUrl("grsComments")},e.effectsTiming={msForEff:["550","570","590","520","550","870","890","810","830","850","1070","1090","1010","1030","1050","1270","1290","1210","1230","1250","1470","1490","1410","1430","1550","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570","1570"],msForEffHor:["500","600","700","800","900","1000","1100","1200","1300","1400","1500","1600"]},e.browser={pfx:["webkit","moz","ms","o",""],name:""},e.checkBrowser=function(){var t=navigator.userAgent;if(t.indexOf("Firefox")!=-1)e.browser.name="Firefox";else if(t.indexOf("OPR")!=-1)e.browser.name="Opera";else if(t.indexOf("Edge")!=-1)e.browser.name="Edge";else if(t.indexOf("Safari")!=-1){var a=/Google Inc/.test(navigator.vendor),n=/Apple Computer/.test(navigator.vendor);a?e.browser.name="Chrome":n&&(e.browser.name="Safari")}else e.browser.name="Explorer"},e.checkBrowser(),e.items=[],e.$watch(function(){return a.popup.show},function(t,n){e.options.show=t,e.params.grs=a.popup.grs,e.params.gallId=a.popup.gallId,e.params.shatts=a.popup.shatts,e.params.theme=a.popup.theme,e.items=a.popup.items,e.view.pI=a.popup.pI,e.view.cP=a.popup.cP,e.view.pC=a.popup.pC,e.view.tC=a.popup.tC,e.view.lC=a.popup.lC,e.view.cImIn=a.popup.index,e.view.noEffect="no"==e.params.shatts.lightboxeffect,e.view.mainAnimationEnd=!0,e.view.loading=!1,e.view.cloading=!1,e.view.outAnimationEnd=!0,e.view.inAnimationEnd=!0,e.view.active="",e.view.actImg="",e.view.grsCC=[],e.view.comments={},e.view.isOCC="1"==e.params.shatts.lightboxcomment,e.view.emptyName=!1,e.view.invalidMail=!1,e.view.emptyComment=!1,e.view.emptyCaptcha=!1,e.view.contButtOp=!1,e.view.isFSSmart=!1,e.view.actImgId=0,e.view.isFS=!1,e.view.ready=!1,e.options.commContloaded=!a.config.comments||"1"!=e.params.shatts.lightboxcomment,e.options.filmContLoaded=!a.config.filmstrip||"1"!=e.params.shatts.lightboxfilmstrip;var i=angular.isString(e.view.cImIn)&&e.view.cImIn.indexOf("hash-")!=-1?e.view.cImIn:a.popup.cP*e.params.shatts.imagesperpage+e.view.cImIn;return"undefined"!=typeof e.view.cachCmmAct&&delete e.view.cachCmmAct,e.options.show?(e.setViewParamsByRes(),e.setEffect(e.params.shatts.lightboxeffect),e.setItem(i),void e.getItems(i)):(delete e.view.firstIn,void(e.view.cImInG=-1))},!0),e.$watch("view.ready",function(){e.view.ready&&e.options.show&&jQuery("html, body").addClass("grsPopupParents")},!0),e.$on("resize::resize",function(){var t=n.innerWidth,a=n.innerHeight,i="1"==e.params.shatts.lightboxfullw?t:e.params.shatts.lightboxwidth,o="1"==e.params.shatts.lightboxfullw?a:e.params.shatts.lightboxheight;e.view.isFS||(nW=t<parseInt(i)?Math.floor(t):parseInt(i),nH=parseInt(o),nH=t<parseInt(i)?Math.floor(nH*nW/parseInt(i)):nH,a<nH&&(nH=Math.floor(a),nW=Math.floor(nH*parseInt(i)/parseInt(o))),e.resizePc(nW,nH))}),e.getItems=function(n){var i=[];if("numbers"==e.params.shatts.pagination){for(var o=0;o<e.view.pC;o++)if("undefined"==typeof e.view.pI[o]){var r={from:o,count:e.params.shatts.imagesperpage};i.push(r)}}else if(e.view.pI[0].length!=e.view.tC){var r={from:e.view.lC,count:e.params.shatts.imagesperpage*(e.view.pC-e.view.lC)};i.push(r)}if(!(i.length>0)){a.log("Images already loaded");for(var s=0;s<e.view.pI.length;s++)e.items=e.items.concat(e.view.pI[s]);return void(e.checkForgrsHash()||e.setFW(n))}t.getPopupData(e.params.gallId,i,e.params.shatts.imagesperpage).then(function(t){if("undefined"!=typeof t.data.success){var o=t.data.success;if("numbers"==e.params.shatts.pagination)for(var r=0;r<i.length;r++){e.view.pI[i[r].from]=[];for(var s=0;s<i[r].count;s++)"undefined"!=typeof o[i[r].count*r+s]&&(e.view.pI[i[r].from][s]=o[i[r].count*r+s])}else e.view.pI[0]=e.view.pI[0].concat(o);for(var g=0;g<e.view.pI.length;g++)e.items=e.items.concat(e.view.pI[g])}else a.log("Error , something went wrong.");e.checkForgrsHash()||e.setFW(n)},function(e){a.log(e)})},e.checkForgrsHash=function(){if(angular.isString(e.view.cImInG)&&e.view.cImInG.indexOf("hash-")!=-1){for(var t=e.view.cImInG.split("hash-")[1],n=!1,i=-1,o=0;o<e.items.length;o++)if(e.items[o].id==t){i=o,n=!0;break}return n?(e.setItem(i,!0),e.setFW(i)):(e.grsCp(),a.log("chkar")),!0}return!1},e.setViewParamsByRes=function(){e.$broadcast("resize::resize")},e.setFW=function(t){e.view.fcw=e.items.length*(e.view.ftw+e.view.ftm+2*(e.view.ftp+e.view.ftbw)),e.moveFC("fromImgNav",t)},e.shFilmsVtop=function(){return!("1"!=e.params.shatts.lightboxfilmstrip||!a.config.filmstrip)&&"top"==e.params.theme.filmstripPos},e.shFilmsVbot=function(){return!("1"!=e.params.shatts.lightboxfilmstrip||!a.config.filmstrip)&&"bottom"==e.params.theme.filmstripPos},e.shCbutts=function(){return"1"==e.params.shatts.lightboxcontbutts},e.shCbuttsVtop=function(){return"1"==e.params.shatts.lightboxcontbutts&&"bottom"==e.params.theme.filmstripPos},e.shCbuttsVbot=function(){return"1"==e.params.shatts.lightboxcontbutts&&"top"==e.params.theme.filmstripPos},e.shCommCont=function(){return!("1"!=e.params.shatts.lightboxcomment||!a.config.comments)},e.shCommContLoaded=function(){e.options.commContloaded=!0,e.$$phase||e.$apply()},e.shFilmContLoaded=function(){e.options.filmContLoaded=!0,e.$$phase||e.$apply()},e.chSwp=function(){return"1"==e.params.shatts.lightboxfullw?"grsPoin":""},e.fisImage=function(){return"video"!=e.img.type&&"link"!=e.img.type},e.sisImage=function(){return"video"!=e.psImg.type&&"link"!=e.psImg.type},e.fisVideo=function(){return"video"==e.img.type&&"first"==e.view.active},e.sisVideo=function(){return"video"==e.psImg.type&&"second"==e.view.active},e.fisLink=function(){return"link"==e.img.type&&"first"==e.view.active},e.sisLink=function(){return"link"==e.psImg.type&&"second"==e.view.active},e.fImSrc=function(){return e.img.version=a.getLightboxImageVer(e.view.icw,e.view.ich),""==e.img.embed?a.uploaderUrl+e.img.path+e.img.version+e.img.name+e.img.type:e.img.path},e.sImSrc=function(){return e.psImg.version=a.getLightboxImageVer(e.view.icw,e.view.ich),""==e.psImg.embed?a.uploaderUrl+e.psImg.path+e.psImg.version+e.psImg.name+e.psImg.type:e.psImg.path},e.setItem=function(t,a){if(e.view.cImInG=t,!angular.isString(e.view.cImInG)||e.view.cImInG.indexOf("hash-")==-1){e.img="undefined"==typeof a?e.view.pI[e.view.cP][e.view.cImIn]:e.items[e.view.cImInG],e.view.cImId=e.img.id,e.setLh(e.img.id),e.fillShU(e.img),e.reloadCap();var n=e.img.type.indexOf(".")!=-1?"image":e.img.type;e["setItem_"+n]()}},e.setItem_image=function(){var t=new Image,n=e.img,i=e.view;n.version=a.getLightboxImageVer(i.icw,i.ich),t.src=""==n.embed?a.uploaderUrl+n.path+n.version+n.name+n.type:n.path,t.cImInG=i.cImInG,t.cImId=n.id,t.complete||4===t.readyState?e.setSomeViewParams(t.cImId):(i.loading=!0,t.onload=function(){if(this.cImInG==i.cImInG){var t=this.cImId;e.setSomeViewParams(t)}else a.log("not same for first ---------- ");a.log("first change loading end ---------- "),e.$apply()})},e.setItem_video=function(){e.setSomeViewParams(e.img.id)},e.setItem_link=function(){e.setItem_video()},e.setSomeViewParams=function(t){var a=e.view;a.loading=!1,a.firstIn=!0,a.active="first",a.actImg="first",a.mainAnimationEnd=!1,a.inAnimationEnd=!1,a.outAnimationEnd=!1,a.actImgId=t,e.fillICC(t)},e.setData=function(t,n,i){var o,r={},s=e.items.length,g=e.view.grsCC,c=g.length-1,m=c>-1;return angular.isString(e.view.cImInG)&&e.view.cImInG.indexOf("hash-")!=-1?void a.log("Hash not changed."):("previous"==t?o=m&&!e.view.loading?g[c]>0?g[c]-1:s-1:e.view.cImInG>0?e.view.cImInG-1:s-1:"next"==t?o=m&&!e.view.loading?g[c]<s-1?g[c]+1:0:e.view.cImInG<s-1?e.view.cImInG+1:0:"other"==t?o="undefined"!=typeof n?n:0:a.log("Unknown change event"),r.imgData=e.items[o],r.cImInG=o,"undefined"==typeof r.imgData?void a.log("Images is not loaded"):e.view.mainAnimationEnd||e.view.noEffect?o==e.view.cImInG?void a.log("Same index ------ "):void e.grsChangeItem(r):(a.log("Animation in progress ------ "),void(a.settings.collapseNavClicks&&g.length<a.settings.clicksCount?(g.push(r.cImInG),a.log(g)):a.log("Stack is full ------ "))))},e.grsLeft=function(t){"undefined"!=typeof t&&t.preventDefault(),e.setData("previous")},e.swipeLeft=function(t){"1"==e.params.shatts.lightboxswipe&&e.grsLeft(t)},e.grsRight=function(t){"undefined"!=typeof t&&t.preventDefault(),e.setData("next")},e.swipeRight=function(t){"1"==e.params.shatts.lightboxswipe&&e.grsRight(t)},e.selectImg=function(t,a){e.setData("other",t,a)},e.grsChangeItem=function(t){var a=t.imgData.type.indexOf(".")!=-1?"image":t.imgData.type;e["grsChange_"+a](t)},e.grsChange_image=function(t){var n=t.imgData,i=e.view,o=e.items[i.cImInG].id;n.version=a.getLightboxImageVer(i.icw,i.ich);var r=new Image;if(r.src=""==n.embed?a.uploaderUrl+n.path+n.version+n.name+n.type:n.path,r.img=n,r.cImInG=t.cImInG,r.cImId=n.id,i.cImInG=t.cImInG,i.cImId=n.id,e.grsDoAction(n,o),!r.complete&&4!==r.readyState)return i.grsCC=[],i.loading=!0,void(r.onload=function(){if(this.cImInG==i.cImInG)if("undefined"==typeof i.firstIn){a.log("firstIn is set after load---------- "),e.img=e.items[this.cImInG],e.psImg=e.img;var t=this.cImId;e.setSomeViewParams(t)}else{if(i.loading=!1,i.actImgId==this.cImId)return void a.log("same id , so not do effect from loaded");a.log("objImg.loaded ---------- ");var n=this;e.setSomeViewParamsForChange(n.img)}else a.log("Not same <---------- ");a.log("Change loading end <---------- "),e.$apply()});if(a.log("objImg.complete ---------- "),"undefined"==typeof i.firstIn)a.log("firstIn is set ---------- "),e.img=e.items[r.cImInG],e.psImg=e.img,e.setSomeViewParams(r.cImId);else{if(i.loading=!1,i.actImgId==i.cImId)return void a.log("same id , so not do effect");e.setSomeViewParamsForChange(n)}},e.setSomeViewParamsForChange=function(t){var n=e.view,i=e.params.shatts.lightboxeffect,o="no"==i?"no":"fade",r="video"!=t.type&&"link"!=t.type&&"video"!=e.img.type&&"link"!=e.img.type&&"video"!=e.psImg.type&&"link"!=e.psImg.type?i:o;a.log("hmikva typ@ -- "+t.type),n.mainAnimationEnd=!1,n.inAnimationEnd=!1,n.outAnimationEnd=!1,e.setEffect(r),e.grsDoEffect(t),e.fillICC(t.id)},e.grsChange_video=function(t){var n=t.imgData,i=e.view,o=e.items[i.cImInG].id;if(i.cImInG=t.cImInG,i.cImId=n.id,e.grsDoAction(n,o),"undefined"==typeof i.firstIn)a.log("firstIn is set ---------- "),e.img=e.items[i.cImInG],e.psImg=e.img,e.setSomeViewParams(i.cImId);else{if(i.loading=!1,i.actImgId==i.cImId)return void a.log("same id , so not do effect");e.setSomeViewParamsForChange(n)}},e.grsChange_link=function(t){e.grsChange_video(t)},e.grsDoAction=function(t,a){e.moveFC("fromImgNav",e.view.cImInG),e.changeLh(a,t.id),e.fillShU(t)},e.grsDoEffect=function(t){e.view.actImgId=t.id,e[e.view.effect.func](e.view.effect.obj,t)},e.fillShU=function(t){var i=e.params.grs;e.view.grsFacebook="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(a.shareUrl+"&imageId="+t.id+"&grs="+i+"&curUrl="+n.location.href),e.view.grsTwitter="https://twitter.com/home?status="+encodeURIComponent(a.shareUrl+"&imageId="+t.id+"&grs="+i+"&curUrl="+n.location.href),e.view.grsGooglePlus="https://plus.google.com/share?url="+encodeURIComponent(a.shareUrl+"&imageId="+t.id+"&grs="+i+"&curUrl="+n.location.href)},e.setLh=function(t){var a=(n.location.hash,e.params.grs);n.location.hash="/grs/"+a+"/id/"+t},e.changeLh=function(t,a){var i=n.location.hash,o=e.params.grs,r=i.replace("/grs/"+o+"/id/"+t,"/grs/"+o+"/id/"+a);n.location.hash=r},e.clearLh=function(){var t=n.location.hash,a=(e.params.grs,t.split("/grs/"));"#"==a[0]?n.location.hash="/":n.location.hash=t.replace("/grs/"+a[1],"")},e.fillICC=function(n){var i=e.view.cImInG;Object.keys(e.view.comments).indexOf(i.toString())==-1&&(e.view.comments[i]=[],e.view.cloading=!0,t.getImgComm(n,e.params.gallId).then(function(t){e.view.cloading=!1,"undefined"!=typeof t.data.success&&(e.view.comments[i]=t.data.success)},function(e){a.log(e)}))},e.postIc=function(){var n="undefined"!=typeof e.view.grsCommName?e.view.grsCommName:"",i="undefined"!=typeof e.view.grsCapCode?e.view.grsCapCode:"",o="undefined"!=typeof e.view.grsCommEmail?e.view.grsCommEmail:"",r="undefined"!=typeof e.view.grsCommText?e.view.grsCommText:"",s=e.view.cImId,g=e.params.gallId,c=e.view.cImInG;return""==n?(e.view.emptyName=!0,void a.log("Name empty")):e.validateEmail(o)?""==r?(e.view.emptyComment=!0,void a.log("Comment empty")):""==i?(e.view.emptyCaptcha=!0,void a.log("Captcha empty")):void(e.view.cloading||(e.view.cloading=!0,t.postIc(n,i,o,r,s,g).then(function(t){if(e.view.cloading=!1,"undefined"!=typeof t.data.success){var i=t.data.success.insert_id,m={id:i,imgId:s,name:n,galId:g,email:o,comment:r,createDate:t.data.success.createDate};e.view.comments[c].push(m),e.view.grsCapCode="",e.view.grsCommText="",e.reloadCap(),e.view.emptyName=!1,e.view.emptyComment=!1,e.view.emptyCaptcha=!1,e.view.invalidMail=!1}else{if("undefined"!=typeof t.data.error)return e.reloadCap(),e.view.grsCapCode="",e.view.emptyCaptcha=!1,void(e.view.emptyCaptcha=!0);a.log("Eror code : "+t.data.error)}},function(e){a.log(e)}))):(e.view.invalidMail=!0,void a.log("Email validation"))},e.validateEmail=function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(e)},e.getFilmImageSrc=function(t){var n=e.items[t],i=a.getFilmImageVer(parseInt(e.params.theme.filmThumbWidth));return""==n.embed?a.uploaderUrl+n.path+i+n.name+n.type:n.thumb_url},e.reloadCap=function(){e.view.cloading||(e.view.cloading=!0,t.reloadCap().then(function(t){e.view.cloading=!1,"undefined"!=typeof t.data.success&&(e.view.captcha=t.data.success)},function(e){a.log(e)}))},e.moveFC=function(t,a){var n,i,o=e.view.flp,r=!1,s=e.view.icw,g=e.view.ftw+e.view.ftm+2*(e.view.ftp+e.view.ftbw);if("left"==t){if(s+o*-1>=e.view.fcw)return;i=(s+o*-1)%g,i=g-i,n=o-i}else if("right"==t){if(0==o)return;var i=(Math.ceil(o*-1/g),o*-1%g);n=0==i?o+g:o+i}else if("fromImgNav"==t)if(sImOfL=a*g,o*-1-sImOfL>0)n=sImOfL*-1;else if(sImOfL>=s+o*-1){i=sImOfL-(o*-1+s)+g;var c=Math.floor(i/g),m=i%g;n=(o*-1+c*g+m)*-1}else i=o*-1+s-sImOfL,r=0==i||i>g,i=g-i,n=o-i;r||(e.view.flp=n,e.$$phase||e.$apply())},e.grsSFM=function(t){var n=document.getElementById("grsPopup");e.view.isFS?(document.fullscreenEnabled?(document.exitFullscreen(),e.view.isFS=!1):document.webkitFullscreenEnabled?(document.webkitExitFullscreen(),e.view.isFS=!1):document.mozFullScreenEnabled?(document.mozCancelFullScreen(),e.view.isFS=!1):document.msFullscreenEnabled&&(document.msExitFullscreen(),e.view.isFS=!1),e.view.isFS||(e.view.isFSSmart=!1),e.$broadcast("resize::resize")):(document.fullscreenEnabled?(n.requestFullscreen(),e.view.isFS=!0):document.webkitFullscreenEnabled?(a.log("webkitRequestFullscreen"),n.webkitRequestFullscreen(),e.view.isFS=!0):document.mozFullScreenEnabled?(n.mozRequestFullScreen(),e.view.isFS=!0):document.msFullscreenEnabled&&(n.msRequestFullscreen(),e.view.isFS=!0),e.view.isFS&&i(function(){e.view.isFSSmart=!0},300),e.resizePc(screen.width,screen.height))},e.resizePc=function(t,i){if(!e.view.mainAnimationEnd&&!e.view.noEffect)return a.log("Animation in progress, trying to resize containner"),e.view.cachResActW=t,void(e.view.cachResActH=i);var o=n.innerWidth,r=n.innerHeight;e.view.mcw=t,e.view.mch=i,e.view.isOCC?(e.view.ccw=Math.floor(40*e.view.mcw/100),e.view.icw=e.view.mcw-e.view.ccw,e.view.ccr=0):(e.view.ccw=Math.floor(40*e.view.mcw/100),e.view.ccr=-e.view.ccw,e.view.icw=e.view.mcw),o<400||r<200?(e.view.fs=35,e.view.ftw=35,e.view.ftm=parseInt(e.params.theme.filmThumbMargin),e.view.fm=parseInt(e.params.theme.filmstripMargin),e.view.ftp=parseInt(e.params.theme.filmThumbPadding),e.view.ftbw="none"!=e.params.theme.filmThumbBorderStyle?parseInt(e.params.theme.filmThumbBorderWidth):0):o<700||r<500?(e.view.fs=50,e.view.ftw=50,e.view.ftm=parseInt(e.params.theme.filmThumbMargin),e.view.fm=parseInt(e.params.theme.filmstripMargin),e.view.ftp=parseInt(e.params.theme.filmThumbPadding),e.view.ftbw="none"!=e.params.theme.filmThumbBorderStyle?parseInt(e.params.theme.filmThumbBorderWidth):0):(e.view.fs=parseInt(e.params.theme.filmstripSize),e.view.ftw=parseInt(e.params.theme.filmThumbWidth),e.view.ftm=parseInt(e.params.theme.filmThumbMargin),e.view.fm=parseInt(e.params.theme.filmstripMargin),e.view.ftp=parseInt(e.params.theme.filmThumbPadding),e.view.ftbw="none"!=e.params.theme.filmThumbBorderStyle?parseInt(e.params.theme.filmThumbBorderWidth):0),e.view.flp=0,e.view.fch=e.view.fs+2*(e.view.ftp+e.view.ftbw+e.view.fm),e.view.ich="1"==e.params.shatts.lightboxfilmstrip?e.view.mch-e.view.fch:e.view.mch,e.view.cbcP="bottom"==e.params.theme.filmstripPos?"top":"bottom",!e.view.contButtOp&&jQuery(".grsPopupB").outerHeight()&&(jQuery(".grsPopupBc").css(e.view.cbcP,-jQuery(".grsPopupB").outerHeight()),a.log(e.view.cbcP+" #$ "+-jQuery(".grsPopupB").outerHeight())),e.items.length>0&&e.setFW(e.view.cImInG),e.view.grsCC.length>0&&e.selectImg(e.view.grsCC.shift(),!0),e.$$phase||e.$apply()},e.clBposRes=function(){return n.innerWidth==e.view.mcw?"grsPopupCoCClosRes":""},e.grsOCC=function(t){var n=e.view;if(!n.isOCC){if(!n.mainAnimationEnd&&!n.noEffect)return a.log("Animation in progress, trying to open comments"),void(n.cachCmmAct=e.grsOCC);var i=n.mcw-n.ccw,o=""==n.active?"first":n.active,r=document.querySelector("."+o+" .forEffect"),s=document.querySelector(".grsPopupImC"+e.params.grs),g=document.querySelector(".grsPopupCoC"+e.params.grs),c=!!r&&r.querySelector("img");jQuery(s).animate({width:i},{duration:500,queue:!1,complete:function(){n.icw=i,n.isOCC=!0,e.items.length>0&&e.moveFC("fromImgNav",n.cImInG),e.$$phase||e.$apply()}}),jQuery(g).animate({right:0},{duration:500,queue:!1,complete:function(){e.$$phase||(n.ccr=0)}}),c&&(jQuery(r).animate({maxWidth:i},{duration:500,queue:!1,complete:function(){}}),jQuery(c).animate({maxWidth:i},{duration:500,queue:!1,complete:function(){n.grsCC.length>0&&e.selectImg(n.grsCC.shift(),!0)}}))}},e.grsCCC=function(t){var n=e.view,i=""==n.active?"first":n.active,o=document.querySelector("."+i+" .forEffect"),r=document.querySelector(".grsPopupImC"+e.params.grs),s=document.querySelector(".grsPopupCoC"+e.params.grs),g=!!o&&o.querySelector("img");return n.mainAnimationEnd||n.noEffect?(jQuery(r).animate({width:n.mcw},{duration:500,queue:!1,complete:function(){n.icw=n.mcw,n.isOCC=!1}}),jQuery(s).animate({right:-n.ccw},{duration:500,queue:!1,complete:function(){e.$$phase||(n.ccr=-n.ccw,e.items.length>0&&(n.flp=0,e.setFW(n.cImInG)))}}),void(g&&(jQuery(g).animate({maxWidth:n.mcw},{duration:500,queue:!1,complete:function(){n.grsCC.length>0&&e.selectImg(n.grsCC.shift(),!0)}}),jQuery(o).animate({maxWidth:n.mcw},{duration:500,queue:!1,complete:function(){}})))):(a.log("Animation in progress, trying to closw comments"),void(n.cachCmmAct=e.grsCCC))},e.grsContEnter=function(t){if("undefined"!=typeof e.contButtsTimeing&&i.cancel(e.contButtsTimeing),jQuery(".grsPopupBc").is(":animated"))return void a.log("animated");if(!e.view.contButtOp){var n={};n[e.view.cbcP]="0px",jQuery(".grsPopupBc").animate(n,{duration:500,complete:function(){e.view.contButtOp=!0,e.$$phase||e.$apply()}})}},e.grsContLeave=function(t){"undefined"!=typeof e.contButtsTimeing&&i.cancel(e.contButtsTimeing),e.contButtsTimeing=i(function(){e.grsCloseButtonsCont()},1e4)},e.grsContOpCl=function(t){if(jQuery(".grsPopupBc").is(":animated"))return void a.log("animated");"undefined"!=typeof e.contButtsTimeing&&i.cancel(e.contButtsTimeing);var n={};n[e.view.cbcP]=e.view.contButtOp?-jQuery(".grsPopupB").outerHeight()+"px":"0px",jQuery(".grsPopupBc").animate(n,{duration:500,complete:function(){e.view.contButtOp=!e.view.contButtOp,e.$$phase||e.$apply()}})},e.grsCloseButtonsCont=function(){var t=jQuery(".grsPopupBc:hover");if(!t&&e.view.contButtOp){var a={};a[e.view.cbcP]=-jQuery(".grsPopupB").outerHeight()+"px",jQuery(".grsPopupBc").animate(a,{duration:500,complete:function(){e.view.contButtOp=!1,e.$$phase||e.$apply()}})}},e.grsCp=function(t){"undefined"!=typeof t&&t.preventDefault(),document.fullscreenEnabled&&document.exitFullscreen?(document.exitFullscreen(),e.view.isFS=!1):document.webkitFullscreenEnabled&&document.webkitExitFullscreen?(document.webkitExitFullscreen(),e.view.isFS=!1):document.mozFullScreenEnabled&&document.mozCancelFullScreen?(document.mozCancelFullScreen(),e.view.isFS=!1):document.msFullscreenEnabled&&document.msExitFullscreen&&(document.msExitFullscreen(),e.view.isFS=!1),jQuery("html, body").removeClass("grsPopupParents");var n={};n.show=!1,n.grs=0,n.gallId=0,n.shatts={},n.theme={},n.pI=[],n.items=[],n.cP=0,n.pC=0,n.tC=0,n.lC=0,n.index=0,a.setPopObj(n),e.clearLh()},e.setEffect=function(t){if("random"==t)return void e.setRandomEffect();for(var a in e.grsEffects)for(var n in e.grsEffects[a].effects)if(n==t){e.view.effect.obj=e.grsEffects[a].effects[n],e.view.effect.name=n,e.view.effect.func=e.grsEffects[a].doEffect,e.view.effect.type=a;break}},e.setRandomEffect=function(){var t=0,a=e.getRandomNum(0,Object.keys(e.grsEffects).length-1);for(var n in e.grsEffects){if(t==a){var i=0,o=e.getRandomNum(0,Object.keys(e.grsEffects[n].effects).length);for(var r in e.grsEffects[n].effects){if(i==o){e.view.effect.obj=e.grsEffects[n].effects[r],e.view.effect.name=r,e.view.effect.func=e.grsEffects[n].doEffect,e.view.effect.type=n;break}i++}}t++}},e.getRandomNum=function(e,t){return Math.floor(Math.random()*t)+e},e.grsNoEffect=function(t,a){"first"==e.view.active?(e.psImg=a,e.view.actImg="second",e.view.active="second"):"second"==e.view.active&&(e.img=a,e.view.actImg="first",e.view.active="first"),e.$$phase||e.$apply()},e.grsNoCuting=function(t,a){"first"==e.view.active?(e.view.active="second",e.psImg=a):"second"==e.view.active&&(e.view.active="first",e.img=a),e.$$phase||e.$apply()},e.grsXcutting=function(t,n){if("first"==e.view.active){var i=e.img,o=""==i.embed?a.uploaderUrl+i.path+i.version+i.name+i.type:i.path,r="first",s="second";e.psImg=n,e.view.active="second",e.view.actImg="second"}else{var g=e.psImg,o=""==g.embed?a.uploaderUrl+g.path+g.version+g.name+g.type:g.path,r="second",s="first";e.img=n,e.view.active="first",e.view.actImg="first"}var c=document.querySelector("div."+r),m=document.querySelector("div."+s),p=c.querySelector("img");m.querySelector("img");e.$$phase||e.$apply();var l=c.childNodes[2].childNodes[1].childNodes[1],u=l.childNodes[2],d=m.childNodes[2].childNodes[1].childNodes[1],h=d.childNodes[2],f=p.getBoundingClientRect(),v=f.width,w=f.height,I=Math.floor(v/11);u&&l.removeChild(u),h&&d.removeChild(h);var C=document.createElement("div");C.style.width=12*I+"px",C.style.height=w+"px",C.style.position="absolute",C.style.top="0px",C.style.left="0px",C.style.textAlign="left",C.setAttribute("class","forlyalya");for(var y=e.effectsTiming.msForEffHor,b=0;b<12;b++){var P=b*I*-1,S=50*b,x=800;11==b&&(S=50*(b-1)),"Safari"==e.browser.name&&(S=0,x=y[b]);var E=document.createElement("div");E.setAttribute("style","width:"+I+"px;height:"+w+"px;position:absolute;left:"+b*I+"px;top:0px;padding:0px;"+t.transformStyle+'margin:0px;background:url("'+o+'") no-repeat '+P+"px 0px;background-size:"+v+"px "+w+"px;-webkit-animation:"+t.name+" "+x+"ms ease-in-out "+S+"ms 1 normal both;-moz-animation:"+t.name+" "+x+"ms ease-in-out "+S+"ms 1 normal both;-ms-animation:"+t.name+" "+x+"ms ease-in-out "+S+"ms 1 normal both;-o-animation:"+t.name+" "+x+"ms ease-in-out "+S+"ms 1 normal both;animation:"+t.name+" "+x+"ms ease-in-out "+S+"ms 1 normal both;"),E.setAttribute("class","grsXorYCutMiniTransElem_"+b),C.appendChild(E)}l.appendChild(C)},e.grsYcutting=function(t,n){if("first"==e.view.active){var i=e.img,o=""==i.embed?a.uploaderUrl+i.path+i.version+i.name+i.type:i.path,r="first",s="second";e.psImg=n,e.view.active="second",e.view.actImg="second"}else{var g=e.psImg,o=""==g.embed?a.uploaderUrl+g.path+g.version+g.name+g.type:g.path,r="second",s="first";e.img=n,e.view.active="first",e.view.actImg="first"}var c=document.querySelector("div."+r),m=document.querySelector("div."+s),p=c.querySelector("img");m.querySelector("img");e.$$phase||e.$apply();var l=c.childNodes[2].childNodes[1].childNodes[1],u=l.childNodes[2],d=m.childNodes[2].childNodes[1].childNodes[1],h=d.childNodes[2],f=p.getBoundingClientRect(),v=f.width,w=f.height,I=Math.floor(w/11);u&&l.removeChild(u),h&&d.removeChild(h);var C=document.createElement("div");C.style.width=v+"px",C.style.height=12*I+"px",C.style.position="absolute",C.style.top="0px",C.style.left="0px",C.style.textAlign="left",C.setAttribute("class","forlyalya");for(var y=e.effectsTiming.msForEffHor,b=0;b<12;b++){var P=b*I*-1,S=50*b,x=800;11==b&&(S=50*(b-1)),"Safari"==e.browser.name&&(S=0,x=y[b]);var E=document.createElement("div");E.setAttribute("style","width:"+v+"px;height:"+I+"px;position:absolute;left:0px;top:"+b*I+"px;"+t.transformStyle+'background:url("'+o+'") no-repeat 0px '+P+"px;background-size:"+v+"px "+w+"px;-webkit-animation:"+t.name+" "+x+"ms ease-in "+S+"ms 1 normal both;-moz-animation:"+t.name+" "+x+"ms ease-in "+S+"ms 1 normal both;-ms-animation:"+t.name+" "+x+"ms ease-in "+S+"ms 1 normal both;-o-animation:"+t.name+" "+x+"ms ease-in "+S+"ms 1 normal both;animation:"+t.name+" "+x+"ms ease-in "+S+'ms 1 normal both;" '),E.setAttribute("class","grsXorYCutMiniTransElem_"+b),C.appendChild(E)}l.appendChild(C)},e.grsXYcutting=function(t,n){if("first"==e.view.active){var i=e.img,o=""==i.embed?a.uploaderUrl+i.path+i.version+i.name+i.type:i.path,r="first",s="second";e.psImg=n,e.view.active="second",e.view.actImg="second"}else{var g=e.psImg,o=""==g.embed?a.uploaderUrl+g.path+g.version+g.name+g.type:g.path,r="second",s="first";e.img=n,e.view.active="first",e.view.actImg="first"}var c=document.querySelector("div."+r),m=document.querySelector("div."+s),p=c.querySelector("img");m.querySelector("img");e.$$phase||e.$apply();var l=c.childNodes[2].childNodes[1].childNodes[1],u=l.childNodes[2],d=m.childNodes[2].childNodes[1].childNodes[1],h=d.childNodes[2],f=p.getBoundingClientRect(),v=f.width,w=f.height,I=Math.floor(v/5),C=Math.floor(w/5),y=document.createElement("div");y.style.width=6*I+"px",y.style.height=6*C+"px",y.style.position="absolute",y.style.top="0px",y.style.left="0px",y.style.textAlign="left",y.setAttribute("class","forlyalya"),u&&l.removeChild(u),h&&d.removeChild(h);for(var b=0,P=0,S=e.effectsTiming.msForEff,x=0;x<6;x++){P="fun"==t.type?70*x+50*x:0;for(var E=0;E<6;E++){var A=x*C*-1,V=E*I*-1,$=1e3;P="fun"==t.type?P+70:30*b,"Safari"==e.browser.name&&(P=0,$=S[b]);var F=document.createElement("div");F.setAttribute("style","width:"+I+"px;height:"+C+"px;float:left;"+t.transformStyle+'background:url("'+o+'") no-repeat '+V+"px "+A+"px;background-size:"+v+"px "+w+"px;-webkit-animation:"+t.name+" "+$+"ms ease-in-out "+P+"ms 1 normal both;-moz-animation:"+t.name+" "+$+"ms ease-in-out "+P+"ms 1 normal both;-ms-animation:"+t.name+" "+$+"ms ease-in-out "+P+"ms 1 normal both;-o-animation:"+t.name+" "+$+"ms ease-in-out "+P+"ms 1 normal both;animation:"+t.name+" "+$+"ms ease-in-out "+P+'ms 1 normal both;" '),
F.setAttribute("class","grsXYCutMiniTransElem_"+b),y.appendChild(F),b++}}l.appendChild(y)},e.grsXYcuttingIn=function(t,n){if("first"==e.view.active){var i="first",o="second";e.psImg=n,e.view.active="second"}else{var i="second",o="first";e.img=n,e.view.active="first"}var r=document.querySelector("div."+i),s=document.querySelector("div."+o),g=(r.querySelector("img"),s.querySelector("img")),c=""==n.embed?a.uploaderUrl+n.path+n.version+n.name+n.type:n.path;g.setAttribute("src",c),e.$$phase||e.$apply(),e.view.actImg="second"==e.view.active?"first":"second";var m=r.childNodes[2].childNodes[1].childNodes[1],p=m.childNodes[2],l=s.childNodes[2].childNodes[1].childNodes[1],u=l.childNodes[2],d=g.clientWidth,h=g.clientHeight;p&&m.removeChild(p),u&&l.removeChild(u);var f=Math.floor(d/5),v=Math.floor(h/5),w=document.createElement("div");w.style.width=6*f+"px",w.style.height=6*v+"px",w.style.position="absolute",w.style.top="0px",w.style.left="0px",w.style.textAlign="left",w.setAttribute("class","forlyalya");for(var I=0,C=0,y=e.effectsTiming.msForEff,b=0;b<6;b++){C="fun"==t.type?50*b+50*b:0;for(var P=0;P<6;P++){var S=b*v*-1,x=P*f*-1,E=1e3;C="fun"==t.type?C+50:30*I,"Safari"==e.browser.name&&(C=0,E=y[I]);var A=document.createElement("div");A.setAttribute("style","width:"+f+"px;height:"+v+"px;float:left;"+t.transformStyle+'background:url("'+c+'") no-repeat '+x+"px "+S+"px;background-size:"+d+"px "+h+"px;-webkit-animation:"+t.name+" "+E+"ms ease-in-out "+C+"ms 1 normal both;-moz-animation:"+t.name+" "+E+"ms ease-in-out "+C+"ms 1 normal both;-ms-animation:"+t.name+" "+E+"ms ease-in-out "+C+"ms 1 normal both;-o-animation:"+t.name+" "+E+"ms ease-in-out "+C+"ms 1 normal both;animation:"+t.name+" "+E+"ms ease-in-out "+C+'ms 1 normal both;" '),A.setAttribute("class","grsXYInCutMiniTransElem_"+I),w.appendChild(A),I++}}l.appendChild(w)},e.classFfI=function(t){return"noCutting"!=e.view.effect.type?"first"==e.view.actImg?"opset":"opzero":"undefined"==typeof e.view.firstIn?"opzero":"opset"},e.classFsI=function(t){return"noCutting"!=e.view.effect.type?"second"==e.view.actImg?"opset":"opzero":"undefined"==typeof e.view.firstIn?"opzero":e.view.firstIn?"opzero":"opset"},e.classFfD=function(t){return e[e.view.effect.type+"_fD"]()},e.classFsD=function(t){return e[e.view.effect.type+"_sD"]()},e.noEffect_fD=function(){return"first"==e.view.active?"active":"pasive"},e.noEffect_sD=function(){return"second"==e.view.active?"active":"pasive"},e.noCutting_fD=function(){return"first"==e.view.active?e.view.effect.obj["in"]+" active":"second"==e.view.active?e.view.effect.obj.out+" pasive":void 0},e.noCutting_sD=function(){return"second"==e.view.active?e.view.effect.obj["in"]+" active":"first"==e.view.active?e.view.effect.obj.out+" pasive":void 0},e.cuttingX_fD=function(){return(e.view.firstIn?"grsFrInEff ":"")+("first"==e.view.active?e.view.effect.obj.activeC+" active":"")},e.cuttingX_sD=function(){return"second"==e.view.active?e.view.effect.obj.activeC+" active":""},e.cuttingY_fD=function(){return(e.view.firstIn?"grsFrInEff ":"")+("first"==e.view.active?e.view.effect.obj.activeC+" active":"")},e.cuttingY_sD=function(){return"second"==e.view.active?e.view.effect.obj.activeC+" active":""},e.cuttingXY_fD=function(){return(e.view.firstIn?"grsFrInEff ":"")+("first"==e.view.active?e.view.effect.obj.activeC+" active":"")},e.cuttingXY_sD=function(){return"second"==e.view.active?e.view.effect.obj.activeC+" active":""},e.cuttingXYIn_fD=function(){return(e.view.firstIn?"grsFrInEff ":"")+("first"==e.view.active?"grsFadeIn grsAnDur active":e.view.effect.obj.pasiveC)},e.cuttingXYIn_sD=function(){return"second"==e.view.active?"grsFadeIn grsAnDur active":e.view.effect.obj.pasiveC},e.PrefixedEvent=function(t){for(var n=e.browser.pfx,i=0;i<n.length;i++)n[i]||(t=t.toLowerCase()),document.querySelector("body").addEventListener(n[i]+t,function(n){if("animationend"==t){if(n.target.getAttribute("class").indexOf("grsFrInEff")!=-1)return a.log('end of first "in" grsFrInEff'),e.view.mainAnimationEnd=!0,e.view.firstIn=!1,"undefined"!=typeof e.view.cachResActW?(e.resizePc(e.view.cachResActW,e.view.cachResActH),delete e.view.cachResActW,void delete e.view.cachResActH):"undefined"!=typeof e.view.cachCmmAct?(e.view.cachCmmAct(),void delete e.view.cachCmmAct):(e.view.grsCC.length>0&&e.selectImg(e.view.grsCC.shift(),!0),a.log('end of first "in" !scope.$$phase --- '+!e.$$phase),void e.$apply());if(n.target.getAttribute("class").indexOf("inAnimationEnd")!=-1){if(a.log("inAnimationEnd anim ------------------- "),e.view.inAnimationEnd=!0,a.log("scope.view.inAnimationEnd --- "+e.view.inAnimationEnd),a.log("scope.view.outAnimationEnd --- "+e.view.outAnimationEnd),!e.view.outAnimationEnd)return;return e.view.firstIn=!1,e.view.mainAnimationEnd=!0,"undefined"!=typeof e.view.cachResActW?(e.resizePc(e.view.cachResActW,e.view.cachResActH),delete e.view.cachResActW,void delete e.view.cachResActH):"undefined"!=typeof e.view.cachCmmAct?(e.view.cachCmmAct(),void delete e.view.cachCmmAct):(e.view.grsCC.length>0&&(a.log("scope.view.grsCC.shift in ------------- "),a.log(e.view.grsCC),e.selectImg(e.view.grsCC.shift(),!0)),void e.$apply())}if(n.target.getAttribute("class").indexOf("outAnimationEnd")!=-1){if(a.log("outAnimationEnd anim ------------- "),e.view.outAnimationEnd=!0,a.log("scope.view.outAnimationEnd --- "+e.view.outAnimationEnd),a.log("scope.view.inAnimationEnd --- "+e.view.inAnimationEnd),!e.view.inAnimationEnd)return;return e.view.firstIn=!1,e.view.mainAnimationEnd=!0,"undefined"!=typeof e.view.cachResActW?(e.resizePc(e.view.cachResActW,e.view.cachResActH),delete e.view.cachResActW,void delete e.view.cachResActH):"undefined"!=typeof e.view.cachCmmAct?(e.view.cachCmmAct(),void delete e.view.cachCmmAct):(e.view.grsCC.length>0&&(a.log("scope.view.grsCC.shift ------------- "),a.log(e.view.grsCC),e.selectImg(e.view.grsCC.shift(),!0)),void e.$apply())}if(n.target.getAttribute("class").indexOf("grsXorYCutMiniTransElem_11")!=-1)return e.view.mainAnimationEnd=!0,"undefined"!=typeof e.view.cachResActW?(e.resizePc(e.view.cachResActW,e.view.cachResActH),delete e.view.cachResActW,void delete e.view.cachResActH):"undefined"!=typeof e.view.cachCmmAct?(e.view.cachCmmAct(),void delete e.view.cachCmmAct):(e.view.grsCC.length>0&&e.selectImg(e.view.grsCC.shift(),!0),a.log("grsXorYCutMiniTransElem_11 end ---------- "),a.log(e.view.grsCC),void e.$apply());if(n.target.getAttribute("class").indexOf("grsXYCutMiniTransElem_35")!=-1)return e.view.mainAnimationEnd=!0,"undefined"!=typeof e.view.cachResActW?(e.resizePc(e.view.cachResActW,e.view.cachResActH),delete e.view.cachResActW,void delete e.view.cachResActH):"undefined"!=typeof e.view.cachCmmAct?(e.view.cachCmmAct(),void delete e.view.cachCmmAct):(e.view.grsCC.length>0&&e.selectImg(e.view.grsCC.shift(),!0),a.log("grsXYCutMiniTransElem_35 end ---------- "),a.log(e.view.grsCC),void e.$apply());if(n.target.getAttribute("class").indexOf("grsXYInCutMiniTransElem_35")!=-1){e.view.actImg="second"==e.view.actImg?"first":"second",e.view.mainAnimationEnd=!0;var i=document.querySelector("div."+e.view.active).childNodes[2].childNodes[1].childNodes[1];return forlyalya=i.childNodes[2],forlyalya&&i.removeChild(forlyalya),"undefined"!=typeof e.view.cachResActW?(e.resizePc(e.view.cachResActW,e.view.cachResActH),delete e.view.cachResActW,delete e.view.cachResActH,void e.$apply()):"undefined"!=typeof e.view.cachCmmAct?(e.view.cachCmmAct(),delete e.view.cachCmmAct,void e.$apply()):(e.view.grsCC.length>0&&e.selectImg(e.view.grsCC.shift(),!0),void e.$apply())}}},!1)},e.keyBoardEvents=function(){document.addEventListener("keydown",function(t){if(e.options.show){var a=t.key;if("Control"!==a&&!t.ctrlKey){switch(a){case"ArrowRight":case"Right":e.grsRight();break;case"ArrowLeft":case"Left":e.grsLeft();break;case"Escape":case"Esc":e.grsCp();break;case" ":case"Spacebar":e.grsContOpCl();break;default:return}return void(e.$$phase||e.$apply())}}},!1)},e.fullscreenChange=function(){document.addEventListener("webkitfullscreenchange",function(t){e.view.isFSSmart&&e.grsSFM()}),document.addEventListener("mozfullscreenchange",function(t){e.view.isFSSmart&&e.grsSFM()}),document.addEventListener("fullscreenchange",function(t){e.view.isFSSmart&&e.grsSFM()}),document.addEventListener("MSFullscreenChange",function(t){e.view.isFSSmart&&e.grsSFM()})},e.PrefixedEvent("AnimationEnd"),e.keyBoardEvents(),e.fullscreenChange()}}}]),grsApp.directive("grsMosaic",["$filter","GrsFactory","GrsService","$window",function(e,t,a,n){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:a.getViewsTemplateUrl("grsMosaic"),link:function(e,i,o){e.sortingOrder="id",e.reverse=!0,e.message={type:"success",show:!1,text:""},e.params.contHeight=50,e.params.contHeightFirstBinding=!1,e.params.loadedCount=0,e.pageination={forGallery:!0,grs:e.params.grs,items:e.params.data.images,navView:e.params.shatts.pagination,gallery:e.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(e.params.shatts.imagesperpage),pagedItems:[],scrolling:!1,loading:!0,positioning:function(){e.MosaicPositioning()},message:function(t,a,n){e.message.show=t,e.message.text=a,e.message.type="undefined"!=typeof n?n:"success"},checkScrolling:function(){return a.log("ekanq mas scrolling"),e.checkScrolling()}},e.grsCreatePopup=function(t,n){"undefined"!=typeof n&&n.preventDefault();var i={};i.show=!0,i.grs=e.params.grs,i.gallId=e.params.shatts.id,i.shatts=e.params.shatts,i.theme=e.params.data.theme,i.items=[],i.pI=e.pageination.pagedItems,i.cP=e.pageination.currentPage,i.pC=e.pageination.pagesCount,i.tC=e.pageination.totalcount,i.lC=e.pageination.loadedCount,i.index=t,a.setPopObj(i)},e.$on("resize::resize",function(){e.pageination.gallExists&&(e.pageination.positioning(),e.$$phase||e.$apply())}),e.$on("scroll::scroll",function(){if("scrolling"==e.pageination.navView&&!e.pageination.loading){var t=jQuery("#grsGal"+e.params.grs).offset().top,i=jQuery("#grsGal"+e.params.grs).innerHeight(),o=t+i,r=n.innerHeight,s=n.pageYOffset+r;s-o>r/10?(e.pageination.scrolling=!0,a.log("thumb mek 10ic ancanq")):e.pageination.scrolling=!1,e.$$phase||e.$apply()}}),e.checkScrolling=function(){if("scrolling"==e.pageination.navView){var t=jQuery("html").innerHeight();if(a.log("jjj "+(n.pageYOffset+n.innerHeight)),a.log("vvv "+t),a.log("grsGallHeight "+i.find(".grsImsCont").innerHeight()),n.innerHeight>=t||n.pageYOffset+n.innerHeight>t){a.log("activate scrolling"),a.log("new val for right fireing watcher");var o=e.pageination.scrolling?e.pageination.scrolling:2;return a.log("gaga"+o),o*o}return!1}},e.$watch(function(){if("scrolling"==e.pageination.navView){if(e.pageination.loading)return a.log("Height watcher loading is true"),void a.log("Height watcher loading params height "+e.params.contHeight);var t=i.find(".grsImsCont").innerHeight();return 0==t?void a.log("Height watcher , gallCont@ der live height chuni"):Math.round(e.params.contHeight)==Math.round(t)?void(e.params.loadedCount!=e.pageination.loadedCount?(e.params.loadedCount=e.pageination.loadedCount,e.pageination.scrolling=e.checkScrolling()):a.log("loaded - "+e.pageination.loadedCount)):void a.log("live height not set or same live height")}}),e.imgLoaded=function(t,a){e.pageination.pagedItems[e.pageination.currentPage][t].show=!0},e.params.getDataById=function(t,a,n){var i={},o=0;itemsCount=e.pageination.items.length;for(var r=0;r<itemsCount;r++)if(e.pageination.items[r].id==t){o=r;break}return i.imgData=e.pageination.items[o],i.curentImgIndex=o,i},e.MosaicPositioning=function(){"ver"==e.params.shatts.type?t.MosaicVerPositioning(e.params,e.pageination,""):t.MosaicHorPositioning(e.params,e.pageination,"")},e.getImageSrc=function(t){var n=e.pageination.pagedItems[e.pageination.currentPage][t];return a.getImageSource(n,"mosaic")},e.grsShTC=function(){return a.grsShTC(e.params.shatts.title,e.params.data.theme.mosaicTEffect)},e.shVIc=function(t){return a.shVIc(e.pageination.pagedItems[e.pageination.currentPage][t])},e.grsOnhv=function(){return a.grsOnhv(e.params.shatts.title)?"grsTOnhover":""},e.grsShMC=function(){return a.grsShMC(e.params.shatts.title,e.params.data.theme.mosaicTEffect)},e.CheckGrsHash=function(){var t=n.location.hash,a=e.params.grs,i=!1;if(t.indexOf("grs")!==-1){var o=t.split("/");if(o[2]==a){imageId=o.pop();for(var r=0;r<e.pageination.pagedItems[0].length;r++)if(e.pageination.pagedItems[0][r].id==imageId){i=!0;break}i?e.grsCreatePopup(r):e.grsCreatePopup("hash-"+imageId)}}},t.getGalleryData(0,e.pageination.itemsPerPage,e.params.shatts.id,1,e.params.shatts.theme,e.params.shatts.view).then(function(t){e.pageination.gallExists=t.data.gallExists,e.pageination.loading=!1,e.params.data.theme=t.data.theme,e.pageination.pagedItems[0]=t.data.images,e.pageination.totalcount=t.data.count,e.pageination.pagesCount=Math.ceil(e.pageination.totalcount/e.pageination.itemsPerPage),e.pageination.loadedCount=e.pageination.pagesCount>0?1:0,e.pageination.gallExists&&(e.pageination.positioning(),e.CheckGrsHash())},function(e){a.log(e)})}}}]),grsApp.directive("grsMasonry",["$filter","GrsFactory","GrsService","$window",function(e,t,a,n){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:a.getViewsTemplateUrl("grsMasonry"),link:function(e,i,o){e.sortingOrder="id",e.reverse=!0,e.message={type:"success",show:!1,text:""},e.params.contHeight=50,e.params.contHeightFirstBinding=!1,e.params.loadedCount=0,e.pageination={forGallery:!0,grs:e.params.grs,items:e.params.data.images,navView:e.params.shatts.pagination,gallery:e.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,view:e.params.shatts.pagination,itemsPerPage:parseInt(e.params.shatts.imagesperpage),pagedItems:[],scrolling:!1,loading:!0,positioning:function(){e.MasonryPositioning()},message:function(t,a,n){e.message.show=t,e.message.text=a,e.message.type="undefined"!=typeof n?n:"success"},checkScrolling:function(){return a.log("ekanq mas scrolling"),e.checkScrolling()}},e.grsCreatePopup=function(t,n){"undefined"!=typeof n&&n.preventDefault();var i={};i.show=!0,i.grs=e.params.grs,i.gallId=e.params.shatts.id,i.shatts=e.params.shatts,i.theme=e.params.data.theme,i.items=[],i.pI=e.pageination.pagedItems,i.cP=e.pageination.currentPage,i.pC=e.pageination.pagesCount,i.tC=e.pageination.totalcount,i.lC=e.pageination.loadedCount,i.index=t,a.setPopObj(i)},e.$on("resize::resize",function(){e.pageination.gallExists&&(e.pageination.positioning(),e.$$phase||e.$apply())}),e.$on("scroll::scroll",function(){if("scrolling"==e.pageination.navView&&!e.pageination.loading){var t=jQuery("#grsGal"+e.params.grs).offset().top,a=jQuery("#grsGal"+e.params.grs).innerHeight(),i=t+a,o=n.innerHeight,r=n.pageYOffset+o;r-i>o/10?e.pageination.scrolling=!0:e.pageination.scrolling=!1,e.$$phase||e.$apply()}}),e.checkScrolling=function(){if("scrolling"==e.pageination.navView){var t=jQuery("html").innerHeight();if(n.innerHeight>=t||n.pageYOffset+n.innerHeight>t){var a=e.pageination.scrolling?e.pageination.scrolling:2;return a*a}return!1}},e.$watch(function(){if("scrolling"==e.pageination.navView&&!e.pageination.loading){var t=i.find(".grsImsCont").innerHeight();if(0!=t)return Math.round(e.params.contHeight)==Math.round(t)?void(e.params.loadedCount!=e.pageination.loadedCount?(e.params.loadedCount=e.pageination.loadedCount,e.pageination.scrolling=e.checkScrolling()):a.log("loaded - "+e.pageination.loadedCount)):void a.log("live height@ not set")}}),e.imgLoaded=function(t,a){e.pageination.pagedItems[e.pageination.currentPage][t].show=!0},e.MasonryPositioning=function(){"ver"==e.params.shatts.type?t.MasonryVerPositioning(e.params,e.pageination,""):t.MasonryHorPositioning(e.params,e.pageination,"")},e.grsShTC=function(){return a.grsShTC(e.params.shatts.title,e.params.data.theme.masonryTEffect)},e.shVIc=function(t){return a.shVIc(e.pageination.pagedItems[e.pageination.currentPage][t])},e.grsOnhv=function(){return a.grsOnhv(e.params.shatts.title)?"grsTOnhover":""},e.grsShMC=function(){return a.grsShMC(e.params.shatts.title,e.params.data.theme.masonryTEffect)},e.getImageSrc=function(t){var n=e.pageination.pagedItems[e.pageination.currentPage][t];return a.getImageSource(n,"masonry")},e.CheckGrsHash=function(){var t=n.location.hash,a=e.params.grs,i=!1;if(t.indexOf("grs")!==-1){var o=t.split("/");if(o[2]==a){imageId=o.pop();for(var r=0;r<e.pageination.pagedItems[0].length;r++)if(e.pageination.pagedItems[0][r].id==imageId){i=!0;break}i?e.grsCreatePopup(r):e.grsCreatePopup("hash-"+imageId)}}},t.getGalleryData(0,e.pageination.itemsPerPage,e.params.shatts.id,1,e.params.shatts.theme,e.params.shatts.view).then(function(t){e.pageination.gallExists=t.data.gallExists,e.pageination.loading=!1,e.params.data.theme=t.data.theme,e.pageination.pagedItems[0]=t.data.images,e.pageination.totalcount=t.data.count,e.pageination.pagesCount=Math.ceil(e.pageination.totalcount/e.pageination.itemsPerPage),e.pageination.loadedCount=e.pageination.pagesCount>0?1:0,e.pageination.gallExists&&(e.pageination.positioning(),e.CheckGrsHash())},function(e){a.log(e)})}}}]),grsApp.directive("grsThumbnail",["$filter","GrsFactory","GrsService","$window",function(e,t,a,n){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:a.getViewsTemplateUrl("grsThumbnail"),link:function(e,i,o){e.sortingOrder="id",e.reverse=!0,e.message={type:"success",show:!1,text:""},a.log(e.params),e.params.contHeight=50,e.params.contHeightFirstBinding=!1,e.params.loadedCount=0,e.pageination={forGallery:!0,grs:e.params.grs,items:[],navView:e.params.shatts.pagination,gallery:e.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(e.params.shatts.imagesperpage),pagedItems:[],scrolling:!1,loading:!0,positioning:function(){t.ThumbnailPositioning(e.params,this,"")},message:function(t,a,n){e.message.show=t,e.message.text=a,e.message.type="undefined"!=typeof n?n:"success"},checkScrolling:function(){return a.log("ekanq mas scrolling"),e.checkScrolling()}},e.grsCreatePopup=function(t,n){"undefined"!=typeof n&&n.preventDefault();var i={};i.show=!0,i.grs=e.params.grs,i.gallId=e.params.shatts.id,i.shatts=e.params.shatts,i.theme=e.params.data.theme,i.items=[],i.pI=e.pageination.pagedItems,i.cP=e.pageination.currentPage,i.pC=e.pageination.pagesCount,i.tC=e.pageination.totalcount,i.lC=e.pageination.loadedCount,i.index=t,a.setPopObj(i)},e.$on("resize::resize",function(){e.pageination.gallExists&&(e.pageination.positioning(),e.$$phase||e.$apply())}),e.$on("scroll::scroll",function(){if("scrolling"==e.pageination.navView&&!e.pageination.loading){var t=jQuery("#grsGal"+e.params.grs).offset().top,i=jQuery("#grsGal"+e.params.grs).innerHeight(),o=t+i,r=n.innerHeight,s=n.pageYOffset+r;s-o>r/10?(e.pageination.scrolling=!0,a.log("thumb mek 10ic ancanq")):e.pageination.scrolling=!1,e.$$phase||e.$apply()}}),e.checkScrolling=function(){if("scrolling"==e.pageination.navView){var t=jQuery("html").innerHeight();if(n.innerHeight>=t||n.pageYOffset+n.innerHeight>t){var a=e.pageination.scrolling?e.pageination.scrolling:2;return a*a}return!1}},e.$watch(function(){if("scrolling"==e.pageination.navView&&!e.pageination.loading){var t=i.find(".grsImsCont").innerHeight();if(0==t)return void a.log("Height watcher , gallCont@ der live height chuni");if(Math.round(e.params.contHeight)==Math.round(t)){if(e.params.loadedCount==e.pageination.loadedCount)return;return e.params.loadedCount=e.pageination.loadedCount,void(e.pageination.scrolling=e.checkScrolling())}a.log("live height@ not set")}}),e.imgLoaded=function(t,a){e.pageination.pagedItems[e.pageination.currentPage][t].show=!0},e.grsShTC=function(){return a.grsShTC(e.params.shatts.title,e.params.data.theme.thumbnailTEffect)},e.grsOnhv=function(){return a.grsOnhv(e.params.shatts.title)?"grsTOnhover":""},e.shVIc=function(t){return a.shVIc(e.pageination.pagedItems[e.pageination.currentPage][t])},e.grsShMC=function(){return a.grsShMC(e.params.shatts.title,e.params.data.theme.thumbnailTEffect)},e.getImageSrc=function(t){var n=e.pageination.pagedItems[e.pageination.currentPage][t];return a.getImageSource(n,"masonry")},e.CheckGrsHash=function(){var t=n.location.hash,a=e.params.grs,i=!1;if(t.indexOf("grs")!==-1){var o=t.split("/");if(o[2]==a){imageId=o.pop();for(var r=0;r<e.pageination.pagedItems[0].length;r++)if(e.pageination.pagedItems[0][r].id==imageId){i=!0;break}i?e.grsCreatePopup(r):e.grsCreatePopup("hash-"+imageId)}}},t.getGalleryData(0,e.pageination.itemsPerPage,e.params.shatts.id,1,e.params.shatts.theme,e.params.shatts.view).then(function(t){e.pageination.gallExists=t.data.gallExists,e.pageination.loading=!1,e.params.data.theme=t.data.theme,e.pageination.pagedItems[0]=t.data.images,e.pageination.totalcount=t.data.count,e.pageination.pagesCount=Math.ceil(e.pageination.totalcount/e.pageination.itemsPerPage),e.pageination.loadedCount=e.pageination.pagesCount>0?1:0,e.pageination.gallExists&&(e.pageination.positioning(),e.CheckGrsHash())},function(e){a.log(e)})}}}]),grsApp.directive("grsFilm",["$filter","GrsFactory","GrsService","$window",function(e,t,a,n){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:a.getViewsTemplateUrl("grsFilm"),link:function(e,i,o){e.sortingOrder="id",e.reverse=!0,e.message={type:"success",show:!1,text:""},a.log(e.params),e.params.contHeight=50,e.params.flp=0,e.params.contHeightFirstBinding=!1,e.params.loadedCount=0,e.pageination={forGallery:!0,grs:e.params.grs,items:[],navView:"scrolling",gallery:e.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(e.params.shatts.imagesperpage),pagedItems:[],scrolling:!1,loading:!0,positioning:function(){t.FilmPositioning(e.params,this,"")},message:function(t,a,n){e.message.show=t,e.message.text=a,e.message.type="undefined"!=typeof n?n:"success"},checkScrolling:function(){return a.log("ekanq mas scrolling"),e.checkScrolling()}},e.moveFC=function(t,a){var n,i,o=e.params.flp,r=!1,s=e.params,g=s.contWidth,c=parseInt(s.shatts.width)+parseInt(s.data.theme.fmThumbmargin)+2*(parseInt(s.data.theme.fmThumbpadding)+("none"!=s.data.theme.fmThumbBorderStyle?parseInt(s.data.theme.fmThumbBorderWidth):0));if("left"==t){if(g+o*-1>=e.params.flWidth)return void(e.pageination.scrolling=!0);i=(g+o*-1)%c,i=c-i,n=o-i}else if("right"==t){if(0==o)return;var i=(Math.ceil(o*-1/c),o*-1%c);n=0==i?o+c:o+i}r||(e.params.flp=n)},i.find(".grsFilm").bind("mousewheel DOMMouseScroll",function(t){var a=t.originalEvent.wheelDelta,n=t.originalEvent.detail;"undefined"!=typeof a?a>0?e.moveFC("right"):e.moveFC("left"):"undefined"!=typeof n&&(n>0?e.moveFC("left"):e.moveFC("right")),t.preventDefault(),e.$$phase||e.$apply()}),e.grsCreatePopup=function(t,n){"undefined"!=typeof n&&n.preventDefault();var i={};i.show=!0,i.grs=e.params.grs,i.gallId=e.params.shatts.id,i.shatts=e.params.shatts,i.theme=e.params.data.theme,i.items=[],i.pI=e.pageination.pagedItems,i.cP=e.pageination.currentPage,i.pC=e.pageination.pagesCount,i.tC=e.pageination.totalcount,i.lC=e.pageination.loadedCount,i.index=t,a.setPopObj(i)},e.$on("resize::resize",function(){e.pageination.gallExists&&(e.pageination.positioning(),e.$$phase||e.$apply())}),e.imgLoaded=function(t,a){e.pageination.pagedItems[e.pageination.currentPage][t].show=!0},e.grsShTC=function(){return a.grsShTC(e.params.shatts.title,e.params.data.theme.fmThumbTEffect)},e.grsOnhv=function(){return a.grsOnhv(e.params.shatts.title)?"grsTOnhover":""},e.shVIc=function(t){return a.shVIc(e.pageination.pagedItems[e.pageination.currentPage][t])},e.grsShMC=function(){return a.grsShMC(e.params.shatts.title,e.params.data.theme.fmThumbTEffect)},e.shFilm=function(){return e.pageination.loadedCount>0},e.getImageSrc=function(t){var n=e.pageination.pagedItems[e.pageination.currentPage][t],i=e.params;return n.thumbWidth=i.thumbWidth,n.thumbHeight=i.thumbHeight,a.getImageSource(n,"thumbnail")},e.CheckGrsHash=function(){var t=n.location.hash,a=e.params.grs,i=!1;if(t.indexOf("grs")!==-1){var o=t.split("/");if(o[2]==a){imageId=o.pop();for(var r=0;r<e.pageination.pagedItems[0].length;r++)if(e.pageination.pagedItems[0][r].id==imageId){i=!0;break}i?e.grsCreatePopup(r):e.grsCreatePopup("hash-"+imageId)}}},t.getGalleryData(0,e.pageination.itemsPerPage,e.params.shatts.id,1,e.params.shatts.theme,e.params.shatts.view).then(function(t){e.pageination.gallExists=t.data.gallExists,e.pageination.loading=!1,e.params.data.theme=t.data.theme,e.pageination.pagedItems[0]=t.data.images,e.pageination.totalcount=t.data.count,e.pageination.pagesCount=Math.ceil(e.pageination.totalcount/e.pageination.itemsPerPage),e.pageination.loadedCount=e.pageination.pagesCount>0?1:0,e.pageination.gallExists&&(e.pageination.positioning(),e.CheckGrsHash())},function(e){a.log(e)})}}}]),grsApp.directive("grsAlbum",["$filter","GrsFactory","GrsService","$window",function(e,t,a,n){return{restrict:"E",transclude:!0,scope:{params:"="},templateUrl:a.getViewsTemplateUrl("grsAlbum"),link:function(e,i,o){e.message={type:"success",show:!1,text:""},e.toUpperCaseFl=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},e.options={grsMainView:a.getViewsTemplateUrl("grsAlbum"+e.params.shatts.mainview),grsGalView:a.getViewsTemplateUrl("grs"+e.params.shatts.galview),albVerHor:"Thumbnail"!=e.params.shatts.mainview?e.toUpperCaseFl(e.params.shatts.masmostype):"",galVerHor:"Thumbnail"!=e.params.shatts.galview?e.toUpperCaseFl(e.params.shatts.galmasmostype):"",albumView:!0,albThRes:{},back:!1,eStack:[]},e.params.contHeight=50,e.params.contHeightFirstBinding=!1,e.params.loadedCount=0,e.params.albumView=e.options.albumView,e.messageF=function(t,a,n){e.message.show=t,e.message.text=a,e.message.type="undefined"!=typeof n?n:"success"},e.mainPageination={forGallery:!1,grs:e.params.grs,items:[],navView:e.params.shatts.pagination,album:e.params.shatts.id,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(e.params.shatts.imagesperpage),pagedItems:[],scrolling:!1,loading:!0,positioning:function(){t[e.params.shatts.mainview+e.options.albVerHor+"Positioning"](e.params,this,".grsAlbum")},message:e.messageF,checkScrolling:function(){return a.log("ekanq mas scrolling"),e.checkScrolling()}},e.pageination={forGallery:!0,grs:e.params.grs,items:[],navView:e.params.shatts.pagination,gallery:0,currentPage:0,totalcount:-1,loadedCount:0,itemsPerPage:parseInt(e.params.shatts.imagesperpage),pagedItems:[],scrolling:!1,loading:!1,positioning:function(){t[e.params.shatts.galview+e.options.galVerHor+"Positioning"](e.params,this,"")},message:e.messageF,checkScrolling:function(){return a.log("ekanq album scrolling"),e.checkScrolling()}},e.$on("resize::resize",function(){if(e.mainPageination.albExists||e.pageination.gallExists){e.params.albumView=e.options.albumView;var t=e.options.albumView?e.mainPageination:e.pageination;t.positioning(),e.$$phase||e.$apply()}}),e.$on("scroll::scroll",function(){if("scrolling"==e.mainPageination.navView){var t=e.options.albumView?e.mainPageination:e.pageination;if(!t.loading){var a=jQuery("#grsGal"+e.params.grs).offset().top,i=jQuery("#grsGal"+e.params.grs).innerHeight(),o=a+i,r=n.innerHeight,s=n.pageYOffset+r;s-o>r/10?t.scrolling=!0:t.scrolling=!1,e.$$phase||e.$apply()}}}),e.checkScrolling=function(){if("scrolling"==e.mainPageination.navView){var t=jQuery("html").innerHeight();if(n.innerHeight>=t||n.pageYOffset+n.innerHeight>t){var a=e.options.albumView?e.mainPageination.scrolling:e.pageination.scrolling;return newVal=a?a:2,newVal*newVal}return!1}},e.$watch(function(){if("scrolling"==e.mainPageination.navView){var t=e.options.albumView?e.mainPageination:e.pageination;if(!t.loading){var n=i.find(".grsImsCont").innerHeight();if(0!=n)return Math.round(e.params.contHeight)==Math.round(n)?void(e.params.loadedCount!=t.loadedCount?(e.params.loadedCount=t.loadedCount,t.scrolling=e.checkScrolling()):a.log("loaded - "+t.loadedCount)):void a.log("live height@ not set")}}}),e.scrollTop=function(){jQuery("html, body").animate({scrollTop:jQuery("#grsGal"+e.params.grs).offset().top-100},500)},e.grsShTC=function(){var t=e.options.albumView?"mainview":"galview",n=e.options.albumView?"title":"galtitle",i=e.params.shatts[t].toLowerCase()+"TEffect";return a.grsShTC(e.params.shatts[n],e.params.data.theme[i])},e.shVIc=function(t){return a.shVIc(e.pageination.pagedItems[e.pageination.currentPage][t])},e.grsShMC=function(){var t=e.options.albumView?"mainview":"galview",n=e.options.albumView?"title":"galtitle",i=e.params.shatts[t].toLowerCase()+"TEffect";return a.grsShMC(e.params.shatts[n],e.params.data.theme[i])},e.grsOnhv=function(){var t=e.options.albumView?"title":"galtitle";return a.grsOnhv(e.params.shatts[t])?"grsTOnhover":""},e.grsCreatePopup=function(t,n){"undefined"!=typeof n&&n.preventDefault();var i={};i.show=!0,i.grs=e.params.grs,i.gallId=e.pageination.gallery,i.shatts=e.params.shatts,i.theme=e.params.data.theme,i.items=[],i.pI=e.pageination.pagedItems,i.cP=e.pageination.currentPage,i.pC=e.pageination.pagesCount,i.tC=e.pageination.totalcount,i.lC=e.pageination.loadedCount,i.index=t,a.setPopObj(i)},e.imgLoaded=function(t,a){var n=e.options.albumView?"mainPageination":"pageination";e[n].pagedItems[e[n].currentPage][t].show=!0},e.grsEnter=function(n,i){i.preventDefault();var o=e.mainPageination.pagedItems[e.mainPageination.currentPage][n].albId,r=e.mainPageination.pagedItems[e.mainPageination.currentPage][n].contentType,s=e.mainPageination.currentPage,g=e.mainPageination.pagesCount,c=e.mainPageination.totalcount;if(e.options.eStack.push({albId:o,cP:s,pC:g,tC:c}),e.mainPageination.loading=!0,e.params.loadedCount=0,"gal"==r)e.pageination.scrolling=!1,e.pageination.loadedCount=0,e.pageination.totalcount=-1,e.pageination.pagesCount=0,t.getGalleryData(0,e.pageination.itemsPerPage,e.mainPageination.pagedItems[s][n].contentId,1,e.params.shatts.theme,e.params.shatts.galview).then(function(t){e.pageination.gallExists=t.data.gallExists,e.mainPageination.loading=!1,e.options.back=!0,e.options.albumView=!1,e.params.albumView=!1,e.pageination.gallery=e.mainPageination.pagedItems[s][n].contentId,e.params.data.theme=t.data.theme,e.pageination.pagedItems=[],e.pageination.currentPage=0,e.pageination.pagedItems[0]=t.data.images,e.pageination.totalcount=t.data.count,e.pageination.pagesCount=Math.ceil(e.pageination.totalcount/e.pageination.itemsPerPage),e.pageination.loadedCount=e.pageination.pagesCount>0?1:0,e.pageination.positioning()},function(e){a.log(e)});else{if("alb"!=r)return void a.log("Something went wrong.");e.mainPageination.scrolling=!1,e.mainPageination.loadedCount=0,e.mainPageination.totalcount=-1,e.mainPageination.pagesCount=0,t.getAlbumData(0,e.mainPageination.itemsPerPage,e.mainPageination.pagedItems[s][n].contentId,1,e.params.shatts.theme,e.params.shatts.mainview).then(function(t){e.mainPageination.albExists=t.data.albExists,e.mainPageination.loading=!1,e.options.back=!0,e.mainPageination.album=e.mainPageination.pagedItems[s][n].contentId,e.params.data.theme=t.data.theme,e.mainPageination.pagedItems=[],e.mainPageination.currentPage=0,e.mainPageination.pagedItems[0]=t.data.content,e.mainPageination.totalcount=t.data.count,e.mainPageination.pagesCount=Math.ceil(e.mainPageination.totalcount/e.mainPageination.itemsPerPage),e.mainPageination.loadedCount=e.mainPageination.pagesCount>0?1:0,a.log("mtanq album "+e.mainPageination.loadedCount),e.mainPageination.positioning()},function(e){a.log(e)})}e.scrollTop()},e.grsBack=function(n){n.preventDefault();var i=e.options.eStack.pop();if("undefined"!=typeof i){var o=e.options.albumView?e.mainPageination:e.pageination;o.loading=!0,e.mainPageination.album=i.albId,e.mainPageination.scrolling=!1,e.mainPageination.loadedCount=0,e.mainPageination.totalcount=-1,e.mainPageination.pagesCount=0,e.params.loadedCount=0,t.getAlbumData(i.cP,e.mainPageination.itemsPerPage,i.albId,0).then(function(t){e.mainPageination.albExists=t.data.albExists,o.loading=!1,0==e.options.eStack.length&&(e.options.back=!1),e.options.albumView=!0,e.params.albumView=!0,e.params.data.theme=e.options.albThRes,e.mainPageination.pagedItems=[],e.mainPageination.pagedItems[i.cP]=t.data.content,e.mainPageination.currentPage=i.cP,e.mainPageination.totalcount=i.tC,
e.mainPageination.pagesCount=i.pC,e.mainPageination.loadedCount=e.mainPageination.pagesCount>0?1:0,e.mainPageination.positioning(),e.scrollTop()},function(e){a.log(e)})}},e.getImageSrc=function(t){var n=e.options.albumView,i=n?"mainPageination":"pageination",o=n?e.params.shatts.mainview:e.params.shatts.galview,r=e[i].pagedItems[e[i].currentPage][t];return"grsnopv"==r.name&&""==r.path?a.imagesDir+r.name+r.type:n?a.uploaderUrl+r.path+a.getImageVer(r,o)+r.name+r.type:a.getImageSource(r,o)},t.getAlbumData(0,e.mainPageination.itemsPerPage,e.params.shatts.id,1,e.params.shatts.theme,e.params.shatts.mainview).then(function(t){e.mainPageination.albExists=t.data.albExists,e.mainPageination.loading=!1,e.params.data.theme=t.data.theme,e.options.albThRes=t.data.theme,e.mainPageination.pagedItems[0]=t.data.content,e.mainPageination.totalcount=t.data.count,e.mainPageination.pagesCount=Math.ceil(e.mainPageination.totalcount/e.mainPageination.itemsPerPage),e.mainPageination.loadedCount=e.mainPageination.pagesCount>0?1:0,e.mainPageination.albExists&&e.mainPageination.positioning()},function(e){a.log(e)})}}}]),grsApp.directive("grsNav",["$filter","$compile","$parse","GrsFactory","GrsService",function(e,t,a,n,i){return{restrict:"E",transclude:!0,scope:{pageInation:"="},template:'<div ng-include="options.grsNavView" class="grsNavInc"></div>',link:function(t,a,o){t.options={showNav:!1},t.$watch("pageInation.navView",function(){t.options.grsNavView="scrolling"!=t.pageInation.navView?i.getViewsTemplateUrl("grsPagenav"+t.pageInation.navView):""},!0),t.$watch("pageInation.totalcount",function(){var e=0==t.pageInation.totalcount,a=t.pageInation.forGallery?"There is no images in this gallery":"Album is empty",a=t.pageInation.forGallery&&!t.pageInation.gallExists?"There is no gallery matching your id or it was deleted":a,a=t.pageInation.forGallery||t.pageInation.albExists?a:"There is no album matching your id or it was deleted",n="error";t.pageInation.message(e,a,n)},!0),t.$watch("pageInation.scrolling",function(){i.log("ekanq scrollingi watcher grsNavum"),i.log("watcher-i arjeq@ "+t.pageInation.scrolling),t.pageInation.scrolling&&(i.log("ekanq scrolling loadmore"),t.loadMore())},!0);var r=function(e,t){return!t||e.toLowerCase().indexOf(t.toLowerCase())!==-1};t.$watch("pageInation.pagesCount",function(){"undefined"!=typeof t.pageInation.pagedItems&&"undefined"!=typeof t.pageInation.pagesCount&&t.showNavF()}),t.search=function(){t.pageInation.filteredItems=e("filter")(t.pageInation.items,function(e){for(var a in e)if(r(e[a],t.query))return!0;return!1}),t.pageInation.currentPage=0,t.groupToPages()},t.groupToPages=function(){t.pageInation.pagedItems=[];for(var e=0;e<t.pageInation.filteredItems.length;e++)e%t.pageInation.itemsPerPage===0?t.pageInation.pagedItems[Math.floor(e/t.pageInation.itemsPerPage)]=[t.pageInation.filteredItems[e]]:t.pageInation.pagedItems[Math.floor(e/t.pageInation.itemsPerPage)].push(t.pageInation.filteredItems[e])},t.range=function(e,t){var a=[];t||(t=e,e=0);for(var n=e;n<t;n++)a.push(n);return a},t.getForGallery=function(e){t.pageInation.loading=!0,n.getGalleryData(e,t.pageInation.itemsPerPage,t.pageInation.gallery,0).then(function(a){t.pageInation.loading=!1,t.pageInation.pagedItems[e]=a.data.images,t.pageInation.currentPage=e,t.pageInation.positioning()},function(e){i.log(e)})},t.getForAlbum=function(e){t.pageInation.loading=!0,n.getAlbumData(e,t.pageInation.itemsPerPage,t.pageInation.album,0).then(function(a){t.pageInation.loading=!1,t.pageInation.pagedItems[e]=a.data.content,t.pageInation.currentPage=e,t.pageInation.positioning()},function(e){i.log(e)})},t.checkPage=function(e){"undefined"==typeof t.pageInation.pagedItems[e]?"undefined"!=typeof t.pageInation.forGallery&&t.pageInation.forGallery?t.getForGallery(e):"undefined"==typeof t.pageInation.forGallery||t.pageInation.forGallery?i.log("Something went wrong."):t.getForAlbum(e):(t.pageInation.currentPage=e,t.pageInation.positioning()),jQuery("html, body").animate({scrollTop:jQuery("#grsGal"+t.pageInation.grs).offset().top-100},500)},t.prevPage=function(){if(t.pageInation.currentPage>0){var e=t.pageInation.currentPage;t.checkPage(--e)}},t.loadMore=function(e){return"undefined"!=typeof e&&e.preventDefault(),t.pageInation.loading?void i.log("Loading in progress"):t.pageInation.loadedCount==t.pageInation.pagesCount||0==t.pageInation.pagesCount?void i.log("Already all is loaded"):"undefined"==typeof t.pageInation.pagedItems[0]?void i.log("Problem with first load"):void("undefined"!=typeof t.pageInation.forGallery&&t.pageInation.forGallery?(t.pageInation.loading=!0,t.pageInation.scrolling=!1,n.getGalleryData(t.pageInation.loadedCount,t.pageInation.itemsPerPage,t.pageInation.gallery,0).then(function(e){t.pageInation.loading=!1,t.pageInation.loadedCount+=1,t.pageInation.pagedItems[0]=t.pageInation.pagedItems[0].concat(e.data.images),t.pageInation.positioning(),t.showNavF()},function(e){i.log(e)})):"undefined"==typeof t.pageInation.forGallery||t.pageInation.forGallery||(t.pageInation.loading=!0,t.pageInation.scrolling=!1,n.getAlbumData(t.pageInation.loadedCount,t.pageInation.itemsPerPage,t.pageInation.album,0).then(function(e){t.pageInation.loading=!1,t.pageInation.loadedCount+=1,t.pageInation.pagedItems[0]=t.pageInation.pagedItems[0].concat(e.data.content),t.pageInation.positioning(),t.showNavF()},function(e){i.log(e)})))},t.nextPage=function(){if(t.pageInation.currentPage<t.pageInation.pagesCount-1){var e=t.pageInation.currentPage;t.checkPage(++e)}},t.lastPage=function(){if(t.pageInation.currentPage<t.pageInation.pagesCount-1){var e=t.pageInation.pagesCount-1;t.checkPage(e)}},t.firstPage=function(){if(t.pageInation.currentPage>0){t.checkPage(0)}},t.setPage=function(){var e=this.n;t.checkPage(e)},t.showNavF=function(){i.log("loaded count - "+t.pageInation.loadedCount),i.log("pagesCount count - "+t.pageInation.pagesCount),"numbers"!=t.pageInation.navView?t.options.showNav=t.pageInation.loadedCount!=t.pageInation.pagesCount&&0!=t.pageInation.pagesCount:t.options.showNav=1!=t.pageInation.pagesCount&&0!=t.pageInation.pagesCount}}}}]),grsApp.factory("GrsFactory",["$http","$q","GrsService",function(e,t,a){return{getGalleryData:function(n,i,o,r,s,g){var c="getGalleryData",m={action:"grsGalleryAjax",grsAction:c,id:o,start:n,count:i,firstRequest:r,theme:r?s:0,view:r?g:""};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(m),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,a,n,i){return t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},getAlbumData:function(n,i,o,r,s,g){var c="getAlbumData",m={action:"grsGalleryAjax",grsAction:c,id:o,start:n,count:i,firstRequest:r,theme:r?s:0,view:r?g:""};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(m),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,a,n,i){return t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},getPopupData:function(n,i,o){var r="getPopupData",s={action:"grsGalleryAjax",grsAction:r,id:n,offsets:i,perPage:o};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(s),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,a,n,i){return t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},getSettings:function(){var n="getSettingsForF",i={action:"grsGalleryAjax",grsAction:n};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(i),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,n,i,o){return a.log(e),t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},getEffects:function(){return e.get(a.effectsJsonUrl).success(function(e){return t.reject(e.data)})},getImgComm:function(n,i){var o="showComments",r={action:"grsGalleryAjax",grsAction:o,id:n,gallId:i};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(r),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,a,n,i){return t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},postIc:function(n,i,o,r,s,g){var c="comment",m={action:"grsGalleryAjax",grsAction:c,name:n,captchaCode:i,email:o,comment:r,imageId:s,galId:g};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(m),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,n,i,o){return a.log(e),t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},reloadCap:function(n,i,o){var r="reloadCaptcha",s={action:"grsGalleryAjax",grsAction:r};return e({method:"POST",url:grsAjaxUrl,data:jQuery.param(s),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,a,n,i){return t.reject(e)}).error(function(e,t){a.log("errr"),401==t&&a.log(e)})},ThumbnailPositioning:function(e,t,a){var n=jQuery("#grsGal"+e.grs).parent().width(),i="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth),o=n*(i/100),r="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),s="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),g=r==s;if(thumbsContainerHeight=0,margin=parseInt(e.data.theme.thumbnailmargin),border="none"!=e.data.theme.thumbnailBorderStyle?2*parseInt(e.data.theme.thumbnailBorderWidth):0,padding=2*parseInt(e.data.theme.thumbnailpadding),thumbsRowHeight=0,columnHeightSum=[],columns=[],border+=padding,countInRow=Math.round(parseInt(o+margin)/(r+border+margin)),countInRow=t.pagedItems[t.currentPage].length<countInRow?t.pagedItems[t.currentPage].length:countInRow,r=(o+margin-countInRow*(border+margin))/countInRow,0==countInRow)return void(e.contHeight=50);for(var c=0;c<countInRow;c++)columns[c]=[],columnHeightSum[c]=0;for(var m=0;m<t.pagedItems[t.currentPage].length;m++){parseInt(t.pagedItems[t.currentPage][m].height),parseInt(t.pagedItems[t.currentPage][m].width);t.pagedItems[t.currentPage][m].thumbHeight=g?r:s,t.pagedItems[t.currentPage][m].thumbWidth=r;var p=Math.min.apply(Math,columnHeightSum),l=columnHeightSum.indexOf(p);columnHeightSum[l]+=s+border+margin,columns[l].push(t.pagedItems[t.currentPage][m])}var u=Math.max.apply(Math,columnHeightSum),d=columnHeightSum.indexOf(u),h=0;thumbsContainerHeight+=columnHeightSum[d]-margin;for(var m=0;m<columns.length;m++){for(var f=0,c=0;c<columns[m].length;c++)columns[m][c].left=h,columns[m][c].top=f,f+=columns[m][c].thumbHeight+border+margin;h+=r+border+margin}o=h-margin,e.contWidth=o,e.contHeight=thumbsContainerHeight},FilmPositioning:function(e,t,a){var n=jQuery("#grsGal"+e.grs).parent().width(),i="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth),o=n*(i/100),r="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),s="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight);margin=parseInt(e.data.theme.fmThumbmargin),contMargin=parseInt(e.data.theme.fmMargin),border="none"!=e.data.theme.fmThumbBorderStyle?parseInt(e.data.theme.fmThumbBorderWidth):0,padding=parseInt(e.data.theme.fmThumbpadding),e.contWidth=o,e.thumbWidth=r,e.thumbHeight=s,e.contHeight=s+2*(contMargin+padding+border),e.flHeight=s+2*(padding+border),e.flWidth=t.pagedItems[t.currentPage].length*(r+margin+2*(padding+border))-margin},MasonryVerPositioning:function(e,t,a){var n=jQuery("#grsGal"+e.grs).parent().width(),i="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth),o=n*(i/100),r="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),s=0,g=parseInt(e.data.theme.masonrymargin),c="none"!=e.data.theme.masonryBorderStyle?2*parseInt(e.data.theme.masonryBorderWidth):0,m=2*parseInt(e.data.theme.masonrypadding),p=[],l=[];if(c+=m,countInRow=Math.round(parseInt(o+g)/(r+c+g)),countInRow=t.pagedItems[t.currentPage].length<countInRow?t.pagedItems[t.currentPage].length:countInRow,r=(o+g-countInRow*(c+g))/countInRow,0==countInRow)return void(e.contHeight=50);for(var u=0;u<countInRow;u++)l[u]=[],p[u]=0;for(var d=0;d<t.pagedItems[t.currentPage].length;d++){var h=parseInt(t.pagedItems[t.currentPage][d].height),f=parseInt(t.pagedItems[t.currentPage][d].width),v=r*h/f;t.pagedItems[t.currentPage][d].thumbHeight=v,t.pagedItems[t.currentPage][d].thumbWidth=r;var w=Math.min.apply(Math,p),I=p.indexOf(w);p[I]+=v+c+g,l[I].push(t.pagedItems[t.currentPage][d])}var C=Math.max.apply(Math,p),y=p.indexOf(C);s+=p[y]-g;for(var b=0,d=0;d<l.length;d++){for(var P=0,u=0;u<l[d].length;u++)l[d][u].left=b,l[d][u].top=P,P+=l[d][u].thumbHeight+c+g;b+=r+c+g}o=b-g,e.contWidth=o,e.contHeight=s},MasonryHorPositioning:function(e,t,a){var n=jQuery("#grsGal"+e.grs).parent().width(),i="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth),o=n*(i/100),r="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),s=0,g=0,c=parseInt(e.data.theme.masonrymargin),m="none"!=e.data.theme.masonryBorderStyle?2*parseInt(e.data.theme.masonryBorderWidth):0,p=2*parseInt(e.data.theme.masonrypadding),l=[];m+=p;for(var u=0,d=0,h=[],f=0;f<t.pagedItems[t.currentPage].length;f++){var v=parseInt(t.pagedItems[t.currentPage][f].height),w=parseInt(t.pagedItems[t.currentPage][f].width),I=r*(w/v);t.pagedItems[t.currentPage][f].thumbHeight=r,t.pagedItems[t.currentPage][f].thumbWidth=I;var C=0==f?m:c+m;if(u+=I+C,u/o>1){0!=f&&l.push(h);var h=[];h.push(t.pagedItems[t.currentPage][f]),u=I+m}else h.push(t.pagedItems[t.currentPage][f])}if(l.push(h),g=l.length,0==g)return void(e.contHeight=50);for(var y=0,f=0;f<l.length;f++){for(var b=0,d=0;d<l[f].length;d++)l[f][d].left=b,l[f][d].top=y,b+=l[f][d].thumbWidth+c+m;y+=r+c+m}s=y,e.contWidth=o,e.contHeight=s},MosaicVerPositioning:function(e,t,a){var n=jQuery("#grsGal"+e.grs).parent().width(),i="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth),o=n*(i/100),r="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.width):parseInt(e.shatts.galwidth),s=0,g=parseInt(e.data.theme.mosaicmargin),c="none"!=e.data.theme.mosaicBorderStyle?2*parseInt(e.data.theme.mosaicBorderWidth):0,m=2*parseInt(e.data.theme.mosaicpadding),p=[],l=[],u=[],d=[],h=1,f=0;if(c+=m,countInRow=Math.round(parseInt(o+g)/(r+c+g)),countInRow=t.pagedItems[t.currentPage].length<countInRow?t.pagedItems[t.currentPage].length:countInRow,0==countInRow)return void(e.contHeight=50);for(var v=0;v<countInRow;v++)p[v]=[],l[v]=0;for(var w=0;w<t.pagedItems[t.currentPage].length;w++){var I=parseInt(t.pagedItems[t.currentPage][w].height),C=parseInt(t.pagedItems[t.currentPage][w].width),y=r*I/C;t.pagedItems[t.currentPage][w].thumbHeight=y,t.pagedItems[t.currentPage][w].thumbWidth=r;var b=Math.min.apply(Math,l),P=l.indexOf(b);l[P]+=y+c+g,p[P].push(t.pagedItems[t.currentPage][w])}for(var w=0;w<p.length;w++){d[w]=0;for(var v=0;v<p[w].length;v++)d[w]+=p[w][v].thumbHeight/p[w][v].thumbWidth}for(var S=p[0].length,x=p.length,w=1;w<p.length;w++){var E=p[w].length;h+=d[0]/d[w],f+=(S*c+(S-1)*g-(E*c+(E-1)*g))/d[w]}u[0]=(o-(x*c+(x-1)*g)-f)/h;for(var w=1;w<d.length;w++){var E=p[w].length;u[w]=(u[0]*d[0]+S*c+(S-1)*g-(E*c+(E-1)*g))/d[w]}for(var A=0,w=0;w<p.length;w++){for(var V=0,v=0;v<p[w].length;v++){var I=parseInt(p[w][v].height),C=parseInt(p[w][v].width),y=u[w]*I/C;p[w][v].thumbWidth=u[w],p[w][v].thumbHeight=y,p[w][v].left=A,p[w][v].top=V,V+=y+c+g}A+=u[w]+c+g}s=V-g,e.contWidth=o,e.contHeight=s},MosaicHorPositioning:function(e,t,a){var n,i=jQuery("#grsGal"+e.grs).parent().width(),o="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.contwidth):parseInt(e.shatts.galcontwidth),r=i*(o/100),s="undefined"==typeof e.albumView||"undefined"!=typeof e.albumView&&e.albumView?parseInt(e.shatts.height):parseInt(e.shatts.galheight),g=0,c=0,m=parseInt(e.data.theme.mosaicmargin),p="none"!=e.data.theme.mosaicBorderStyle?2*parseInt(e.data.theme.mosaicBorderWidth):0,l=2*parseInt(e.data.theme.mosaicpadding),o=parseInt(e.shatts.contwidth),u=[],d=[];p+=l;for(var h=0,f=0,v=[],w=0;w<t.pagedItems[t.currentPage].length;w++){var I=parseInt(t.pagedItems[t.currentPage][w].height),C=parseInt(t.pagedItems[t.currentPage][w].width),y=s*(C/I);t.pagedItems[t.currentPage][w].thumbHeight=s,t.pagedItems[t.currentPage][w].thumbWidth=y;var b=0==w?p:m+p;if(h+=y+b,h/r>1&&w!=t.pagedItems[t.currentPage].length-1){0!=w&&u.push(v);var v=[];v.push(t.pagedItems[t.currentPage][w]),h=y+p}else v.push(t.pagedItems[t.currentPage][w])}if(u.push(v),c=u.length,0==c)return void(e.contHeight=50);if(c>1){if(n=u[c-1],nearLast=u[c-2],nearLast.length/n.length>=2)for(;0!=u[c-1].length;)u[c-2].push(u[c-1].pop());0==u[c-1].length&&u.pop()}for(var w=0;w<u.length;w++){for(var P=0,f=0;f<u[w].length;f++)P+=u[w][f].thumbWidth/u[w][f].thumbHeight;d.push((r-((f-1)*m+f*p))/P)}for(var S=0,w=0;w<u.length;w++){for(var x=0,f=0;f<u[w].length;f++){var E=d[w]*(u[w][f].width/u[w][f].height);u[w][f].thumbWidth=E,u[w][f].thumbHeight=d[w],u[w][f].left=x,u[w][f].top=S,x+=E+m+p}S+=d[w]+m+p}g=S,e.contWidth=r,e.contHeight=g}}}]),grsApp.directive("resize",["$window","GrsService",function(e,t){return{link:function(t){function a(e){t.$broadcast("resize::resize")}function n(){angular.element(e).off("resize",a)}angular.element(e).on("resize",a),t.$on("$destroy",n)}}}]),grsApp.directive("scroll",["$window","GrsService",function(e,t){return{link:function(t){function a(e){t.$broadcast("scroll::scroll",5022)}function n(){angular.element(e).off("scroll",a)}angular.element(e).on("scroll",a),t.$on("$destroy",n)}}}]);